<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imaginator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <section class="flex items-center justify-around h-screen w-screen">
      <div class="container mx-auto px-6 max-w-lg">
        <img src="/imaginator.svg" style="width: 160px" class="mx-auto block mb-6" />
        <h1
          class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-4xl mb-6 text-center"
        >
          Text to image in one click
        </h1>
        <form class="flex mb-6">
          <input
            type="text"
            id="input"
            class="h-10 w-full rounded-l-full border border-gray-400 bg-white px-4 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
            placeholder="Text to imagine"
          /><button
            class="h-10 px-4 py-2 whitespace-nowrap rounded-r-full text-sm font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gray-900 text-white hover:bg-black"
            type="submit"
          >
            Imagine that
          </button>
        </form>
        <div
          class="text-xs text-gray-500 dark:text-gray-400 hidden"
          id="media"
        >
          <div class="p-4 rounded-lg bg-gray-100"><img id="mediaplayer" src /></div>
          <a
            class="underline underline-offset-2 block text-gray-600 text-center"
            download
            filename="image.jpg"
            id="link"
            >Download
          </a>
        </div>
        <div id="error" class="text-red-500 font-bold"></div>
      </div>
    </section>
    <script type="module">
      import tts from "https://tts.jsfn.run/index.mjs";

      window.addEventListener("DOMContentLoaded", () => {
        document.querySelector("form").onsubmit = async (e) => {
          e.preventDefault();

          try {
            media.classList.add("hidden");
            const r = await tts(input.value);

            if (!r.ok) {
              throw new Error("Generation failed: " + await r.text());
            }

            const blob = new Blob([await r.arrayBuffer()], {
              type: "image/png",
            });
            const href = URL.createObjectURL(blob);

            link.href = mediaplayer.src = href;
            media.classList.remove("hidden");
          } catch (e) {
            error.innerText = String(e);
            console.log(e);
          }
        };
      });
    </script>
  </body>
</html>
